---
sidebar_position: 5
title: Develop a Squid
---

# Develop a squid

Below is a general outline of the squid development steps. 

## 0. Prerequisites

- Get familiar with Archives and squids reading with the [Overview](/overview)
- Follow through the [Quickstart](/quickstart) and get yourself familiar with the [squid-template](https://github.com/subsquid/squid-template).

## 1. Model the data with a schema file

Start the development by defining the schema of the target database in the `schema.graphql` in the squid root folder. The schema file also defines the shape of the GraphQL API of the squid. The schema definition consists of regular graphql type declarations annotated with custom directives to define:
- relations between the entities
- entity properties, property types and constraints 
- indexes to be created in the database

A full description of the `schema.graphql` dialect is available [here](/develop-a-squid/schema-spec).

## 2. Generate TypeORM classes

The squid processor data handlers use [TypeORM](https://typeorm.io) entities
to interact with the target database during the data processing. All necessary entity classes are
generated by the squid framework from `schema.graphql` with `make codegen`.

By convention, the generated model classes are kept in `src/model/generated` by default. Custom user-defined entities can
be added in `src/model/index.ts`.

## 3. Generate the database migrations

All database changes are applied through migration files located at `db/migrations`.
`squid-typeorm-migration(1)` tool provides several commands to drive the process.
It is all [TypeORM](https://typeorm.io/#/migrations) under the hood.

```bash
# Connect to database, analyze its state and generate migration to match the target schema.
# The target schema is derived from entity classes generated earlier.
# Don't forget to compile your entity classes beforehand!
npx squid-typeorm-migration generate

# Create template file for custom database changes
npx squid-typeorm-migration create

# Apply database migrations from `db/migrations`
npx squid-typeorm-migration apply

# Revert the last performed migration
npx squid-typeorm-migration revert         
```

To start from scratch, drop the database and regenerate the entities and the migrations:
```bash
make down
rm -rf db/migrations/*.js
make up
make codegen
make build
npx squid-typeorm-migration generate
```

## 4. Define the squid processor and the data handlers

A squid processor is a separate node.js process that fetches historical on-chain data, performs arbitrary transformations and saves the result into the target database schema defined above. By convention, the processor entry point is `src/processor.ts`.

Subsquid SDK currently offers support only for Substrate-based chains with two base classes for data processing: `SubstrateBatchProcessor` for batch processing and `SubstrateProcessor`. We recommend using `SubstrateBatchProcessor` as it enables up to a 100x performance improvement compared to `SubstrateProcessor`.

The structure for working with a processor instance is the following:

- Initialize the processor by defining the archive data source for the network to be indexed. 
- Specify which data should be fetched by the processor. The data selectors may depend on the type of the source chain. For Substrate chains one can subscribe for block data, call data, or runtime events. Additional options are available for substrate chains supporting EVM and WASM contracts to index only transactions or event logs emitted by a specific contract.  
- Generate typescript definitions for the Substrate, EVM and WASM data types together with the data desereliazation boilerplate.
See [Typegen](/develop-a-squid/typegen-tooling) for more details.
- Define the processor handler(s) that transform the data and save it into the target database schema. 
- Run the processor with `make process`.

## 5. Run locally and test the GraphQL endpoint

Follow [Run a Squid](/run-squid) page for details. Reiterate the steps 1, 2, 3 if there's a need to change the data model. 