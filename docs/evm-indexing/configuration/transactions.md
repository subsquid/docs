---
sidebar_position: 30
description: >-
  Subscribe to txn data with addTransaction()
---

# EVM transactions 

:::warning
Processor data subscription methods guarantee that all data matching their data requests will be retrieved, but for technical reasons non-matching data may be added to the [batch context iterables](/evm-indexing/context-interfaces). As such, it is important to always filter the data within the batch handler.
:::

:::warning
The meaning of passing `[]` as a set of parameter values has been changed in the ArrowSquid release: now it _selects no data_. Some data might still arrive (see above), but that's not guaranteed. Pass `undefined` for a wildcard selection:
```typescript
.addTransaction({from: []}) // selects no transactions
.addTransaction({}) // selects all transactions
```
:::

#### `addTransaction(options)` {#add-transaction}

Get some _or all_ transactions on the network. `options` has the following structure:
```typescript
{
  // data requests
  from?: string[]
  to?: string[]
  sighash?: string[]
  range?: {from: number, to?: number}

  // related data retrieval
  logs?: boolean
  stateDiffs?: boolean
  traces?: boolean
}
```
Data requests:
+ `from` and `to`: the sets of addresses of tx senders and receivers. Omit to subscribe to transactions from/to any address.
+ `sighash`: [first four bytes](https://ethereum.org/en/developers/docs/transactions/#the-data-field) of the Keccak hash (SHA3) of the canonical representation of the function signature. Omit to subscribe to any transaction.
+ `range`: the range of blocks to consider.

Enabling the `stateDiffs`, `traces` and/or `logs` flags will cause the processor to retrieve [state diffs](/evm-indexing/configuration/state-diffs/), [traces](/evm-indexing/configuration/traces/) and/or event logs that occured as a result of each selected transaction. The data will be added to the appropriate iterables within the [block data](/evm-indexing/context-interfaces).

Note that transactions can also be requested by [`addLog()`](../evm-logs), [`addStateDiff()`](../state-diffs) and [`addTrace()`](../traces) as related data.

Selection of the exact data to be retrieved for each transaction and the optional related data items is done with the `setFields()` method documented on the [Data selection](../data-selection) page. Some examples are available below.

:::info
Typescript ABI modules generated by [`squid-evm-typegen`](/evm-indexing/squid-evm-typegen) provide function sighashes as constants, e.g.

```ts
  import * as erc20abi from './abi/erc20'
  // ...
    sighash: [erc20abi.functions.transfer.sighash],
  // ...
```
:::

## Examples

1) Request all EVM calls to the contract `0x6a2d262D56735DbA19Dd70682B39F6bE9a931D98`:
```ts
processor.addTransaction({to: ['0x6a2d262d56735dba19dd70682b39f6be9a931d98']})
```

2) Request all transactions matching sighash of `transfer(address,uint256)`:
```ts
processor.addTransaction({sighash: ['0xa9059cbb']})
```

3) Request all `transfer(address,uint256)` calls to the specified addresses, from block `6_000_000` onwards and fetch their inputs. Also retrieve all logs emitted by these calls.
```ts
processor
  .addTransaction({
    to: [
      '0x6a2d262d56735dba19dd70682b39f6be9a931d98',
      '0x3795c36e7d12a8c252a20c5a7b455f7c57b60283'
    ],
    sighash: [
      '0xa9059cbb'
    ],
    range: {
      from: 6_000_000
    },
    logs: true
  })
  .setFields({
    transaction: {
      input: true
    }
  })
```

4) Mine all transactions to and from Vitalik Buterin's address [`vitalik.eth`](https://etherscan.io/address/vitalik.eth). Fetch the involved addresses, ETH value and hash for each transaction. Get execution traces with the [default fields](../data-selection/#transactions) for outgoing transactions.

```ts
const VITALIK_ETH = '0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045'.toLowerCase()

const processor = new EvmBatchProcessor()
  .setDataSource({
    archive: lookupArchive('eth-mainnet'),
    chain: 'https://eth-rpc.gateway.pokt.network'
  })
  .setFinalityConfirmation(75)
  .addTransaction({
    to: [VITALIK_ETH]
  })
  .addTransaction({
    from: [VITALIK_ETH],
    traces: true
  })
  .setFields({
    transaction: {
      from: true,
      to: true,
      value: true,
      hash: true
    }
  })

processor.run(new TypeormDatabase(), async (ctx) => {
  for (let c of ctx.blocks) {
    for (let txn of c.transactions) {
      if (txn.to === VITALIK_ETH || txn.from === VITALIK_ETH) {
        // just output the tx data to console
        ctx.log.info(txn, 'Tx:')
      }
    }
  }
})
```
