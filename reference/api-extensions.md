# API Extensions

Squid alows to extend the GraphQL schema generated by OpenReader with custom queries. 
To do that, one can define the GraphQL [query resolvers](https://www.apollographql.com/docs/tutorial/resolvers/) and export in the designated module `src/server-extension/resolvers`.

It is convenient to use [TypeGraphQL](https://typegraphql.com/docs/resolvers.html#) library and the annotations to mark up the query return type.

Custom resolvers are usually used in combination with [TypeORM EntityManager](https://orkhan.gitbook.io/typeorm/docs/entity-manager-api). It is automatically enabled by dependency injection when defined as a constructor argument. 

A typical custom resolver looks as follows:

```typescript
import { Arg, Field, ObjectType, Query, Resolver } from 'type-graphql'
import type { EntityManager } from 'typeorm'
import { MyEntity } from '../../model/generated'

// Define custom GraphQL ObjectType of the query result
@ObjectType()
export class MyQueryResult {
  @Field(() => Number, { nullable: false })
  total!: number

  @Field(() => Number, { nullable: false })
  max!: number

  constructor(props: Partial<MyQueryResult>) {
    Object.assign(this, props);
  }
}

@Resolver()
export class MyResolver {
  // Set by depenency injection
  constructor(private tx: () => Promise<EntityManager>) {}

  @Query(() => [MyQueryResult])
  async myQuery(): Promise<MyQueryResult[]> {
    const manager = await this.tx()
    // execute custom SQL query
    const result: = await manager.getRepository(MyEntity).query(
      `SELECT 
        COUNT(x) as total, 
        MAX(y) as max
      FROM my_entity 
      GROUP BY month`)
    return result
  }
}
```


For more examples of resolvers, see [TypeGraphQL repo](https://github.com/MichalLytek/type-graphql/tree/master/examples)